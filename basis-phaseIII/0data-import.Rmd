---
title: "Data Import"
author: "Teresa Del Bianco"
date: "`r Sys.Date()`"
output: html_document
---

# Load packages 

```{r, message = FALSE, warning = FALSE, include = FALSE}
packs <- c("R.matlab", "reshape2", "dplyr", "multidplyr", "ggplot2", "tidyr")
lapply(packs, require, character.only = TRUE)
```

# Read data from matlab (? Hz)

```{r}
cbfnp_matlabFile  <- readMat('MatFiles/ph3_ET_popout_temporalScores_20191104T222852.mat')
str(cbfnp_matlabFile)
```

AOIS: face, car, phone, noise, bird

There are 8 trials of 10 sec duration. Each trial is identified by the item id (e.g, STATICIMAGES_ONSETPOPOUT1.TIFPOPOUT)

# Trial 1

## AOI = Car

```{r}
datList <- cbfnp_matlabFile$temporal[[1]][[1]][,,2]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
ids <- lapply(cbfnp_matlabFile$temporal[[9]][[1]][,,1], unlist, use.names=FALSE)$ids
time <- lapply(cbfnp_matlabFile$temporal[[9]][[1]][,,1], unlist, use.names=FALSE)$time
# summary(datList.un)
# str(datList.un)
```
```{r}
data_c <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_c) <- ids
```
```{r}
data_c$time <- time
```
```{r}
data_c$aoi.name <- datList.un[[1]][,1]
```
```{r}
head(data_c[,c(1,ncol(data_c)-1,ncol(data_c))])
```

### Format data

```{r}
# names(data)
data_c_long <- melt(data_c,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.car"
        )
# str(data_c_long)
```
```{r}
data_c_long <- select(data_c_long, -aoi.name)
id_age <- colsplit(as.character(data_c_long$id), "_", c("id", "age"))
data_c_long <- cbind(id_age, select(data_c_long, -id))
```

```{r}
add_info <- colsplit(data_c_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_c_long$age <- as.numeric(add_info$age)
data_c_long$group <- as.factor(add_info$group)

# str(data_c_long)
```
```{r}
# unique(data_c_long$age)
```

```{r}
head(data_c_long)
```

## AOI = Bird

```{r}
datList <- cbfnp_matlabFile$temporal[[1]][[1]][,,5]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
ids <- lapply(cbfnp_matlabFile$temporal[[9]][[1]][,,1], unlist, use.names=FALSE)$ids
time <- lapply(cbfnp_matlabFile$temporal[[9]][[1]][,,1], unlist, use.names=FALSE)$time
# summary(datList.un)
# str(datList.un)
```
```{r}
data_b <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_b) <- ids
```
```{r}
data_b$time <- time
```
```{r}
data_b$aoi.name <- datList.un[[1]][,1]
```
```{r}
head(data_b[,c(1,ncol(data_b)-1,ncol(data_b))])
```

### Format data

```{r}
# names(data)
data_b_long <- melt(data_b,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.bird"
        )
# str(data_b_long)
```
```{r}
data_b_long <- select(data_b_long, -aoi.name)
id_age <- colsplit(as.character(data_b_long$id), "_", c("id", "age"))
data_b_long <- cbind(id_age, select(data_b_long, -id))
```

```{r}
add_info <- colsplit(data_b_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_b_long$age <- as.numeric(add_info$age)
data_b_long$group <- as.factor(add_info$group)

# str(data_b_long)
```
```{r}
# unique(data_b_long$age)
```

# CHANGE SCRIPT FROM HERE TO NEW DATA FORMAT

## AOI = Face

```{r}
datList <- cbfnp_matlabFile$temporalScores[[1]][[1]][,,1]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_f <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_f) <- datList.un[[3]]
```
```{r}
data_f$time <- datList.un[[4]][,1]
```
```{r}
data_f$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_f[,c(1,ncol(data_f)-1,ncol(data_f))])
```

### Format data

```{r}
# names(data)
data_f_long <- melt(data_f,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.face"
        )
# str(data_f_long)
```
```{r}
data_f_long <- select(data_f_long, -aoi.name)
id_age <- colsplit(as.character(data_f_long$id), "_", c("id", "age"))
data_f_long <- cbind(id_age, select(data_f_long, -id))
```

```{r}
add_info <- colsplit(data_f_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_f_long$age <- as.numeric(add_info$age)
data_f_long$group <- as.factor(add_info$group)

# str(data_f_long)
```
```{r}
# unique(data_f_long$age)
```

## AOI = Noise

```{r}
datList <- cbfnp_matlabFile$temporalScores[[1]][[1]][,,4]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_n <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_n) <- datList.un[[3]]
```
```{r}
data_n$time <- datList.un[[4]][,1]
```
```{r}
data_n$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_n[,c(1,ncol(data_n)-1,ncol(data_n))])
```

### Format data

```{r}
# names(data)
data_n_long <- melt(data_n,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.noise"
        )
# str(data_n_long)
```
```{r}
data_n_long <- select(data_n_long, -aoi.name)
id_age <- colsplit(as.character(data_n_long$id), "_", c("id", "age"))
data_n_long <- cbind(id_age, select(data_n_long, -id))
```

```{r}
add_info <- colsplit(data_n_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_n_long$age <- as.numeric(add_info$age)
data_n_long$group <- as.factor(add_info$group)

# str(data_n_long)
```
```{r}
# unique(data_n_long$age)
```

## AOI = Phone

```{r}
datList <- cbfnp_matlabFile$temporalScores[[1]][[1]][,,3]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_p <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_p) <- datList.un[[3]]
```
```{r}
data_p$time <- datList.un[[4]][,1]
```
```{r}
data_p$aoi.name <- datList.un[[1]][,1]
```
```{r}
head(data_p[,c(1,ncol(data_p)-1,ncol(data_p))])
```

### Format data

```{r}
# names(data)
data_p_long <- melt(data_p,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.phone"
        )
# str(data_p_long)
```
```{r}
data_p_long <- select(data_p_long, -aoi.name)
id_age <- colsplit(as.character(data_p_long$id), "_", c("id", "age"))
data_p_long <- cbind(id_age, select(data_p_long, -id))
```

```{r}
add_info <- colsplit(data_p_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_p_long$age <- as.numeric(add_info$age)
data_p_long$group <- as.factor(add_info$group)

# str(data_p_long)
```
```{r}
# unique(data_p_long$age)
```

## Merge datasets

```{r}
# dim(data_c_long)
# dim(data_b_long)
```

```{r}
cb <- left_join(data_c_long, data_b_long, by=c("id", "time", "age", "group"))
cbf <- left_join(cb, data_f_long, by=c("id", "time", "age", "group"))
cbfn <- left_join(cbf, data_n_long, by=c("id", "time", "age", "group"))
cbfnp <- left_join(cbfn, data_p_long, by=c("id", "time", "age", "group"))
cbfnp.1 <- cbfnp %>%
  mutate(trial="STATICIMAGES_ONSETPOPOUT1.TIFPOPOUT",
         item=gsub(pattern = "STATICIMAGES_ONSETPOPOUT", 
                    replacement = "",
                    x=trial)) %>%
  mutate(item=as.numeric(gsub(pattern = ".TIFPOPOUT", 
                    replacement = "",
                    x=item))) %>%
  select(id, age, group, time, trial, item, plt.car, plt.bird, plt.face, plt.noise, plt.phone)
# head(cbfnp.1)
```

```{r}
rm(list=setdiff(ls(), ls(pattern = c("cbfnp"))))
```

# Trial 2

## AOI = Car

```{r}
datList <- cbfnp_matlabFile$temporalScores[[2]][[1]][,,2]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
summary(datList.un)
# str(datList.un)
```
```{r}
data_c <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_c) <- datList.un[[3]]
```
```{r}
data_c$time <- datList.un[[4]][,1]
```
```{r}
data_c$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_c[,c(1,ncol(data_c)-1,ncol(data_c))])
```

### Format data

```{r}
# names(data)
data_c_long <- melt(data_c,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.car"
        )
# str(data_c_long)
```
```{r}
data_c_long <- select(data_c_long, -aoi.name)
id_age <- colsplit(as.character(data_c_long$id), "_", c("id", "age"))
data_c_long <- cbind(id_age, select(data_c_long, -id))
```

```{r}
add_info <- colsplit(data_c_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_c_long$age <- as.numeric(add_info$age)
data_c_long$group <- as.factor(add_info$group)

# str(data_c_long)
```
```{r}
# unique(data_c_long$age)
```

## AOI = Bird

```{r}
datList <- cbfnp_matlabFile$temporalScores[[2]][[1]][,,5]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_b <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_b) <- datList.un[[3]]
```
```{r}
data_b$time <- datList.un[[4]][,1]
```
```{r}
data_b$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_b[,c(1,ncol(data_b)-1,ncol(data_b))])
```

### Format data

```{r}
# names(data)
data_b_long <- melt(data_b,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.bird"
        )
# str(data_b_long)
```
```{r}
data_b_long <- select(data_b_long, -aoi.name)
id_age <- colsplit(as.character(data_b_long$id), "_", c("id", "age"))
data_b_long <- cbind(id_age, select(data_b_long, -id))
```

```{r}
add_info <- colsplit(data_b_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_b_long$age <- as.numeric(add_info$age)
data_b_long$group <- as.factor(add_info$group)

# str(data_b_long)
```
```{r}
# unique(data_b_long$age)
```

## AOI = Face

```{r}
datList <- cbfnp_matlabFile$temporalScores[[2]][[1]][,,1]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_f <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_f) <- datList.un[[3]]
```
```{r}
data_f$time <- datList.un[[4]][,1]
```
```{r}
data_f$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_f[,c(1,ncol(data_f)-1,ncol(data_f))])
```

### Format data

```{r}
# names(data)
data_f_long <- melt(data_f,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.face"
        )
# str(data_f_long)
```
```{r}
data_f_long <- select(data_f_long, -aoi.name)
id_age <- colsplit(as.character(data_f_long$id), "_", c("id", "age"))
data_f_long <- cbind(id_age, select(data_f_long, -id))
```

```{r}
add_info <- colsplit(data_f_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_f_long$age <- as.numeric(add_info$age)
data_f_long$group <- as.factor(add_info$group)

# str(data_f_long)
```
```{r}
# unique(data_f_long$age)
```

## AOI = Noise

```{r}
datList <- cbfnp_matlabFile$temporalScores[[2]][[1]][,,4]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_n <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_n) <- datList.un[[3]]
```
```{r}
data_n$time <- datList.un[[4]][,1]
```
```{r}
data_n$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_n[,c(1,ncol(data_n)-1,ncol(data_n))])
```

### Format data

```{r}
# names(data)
data_n_long <- melt(data_n,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.noise"
        )
# str(data_n_long)
```
```{r}
data_n_long <- select(data_n_long, -aoi.name)
id_age <- colsplit(as.character(data_n_long$id), "_", c("id", "age"))
data_n_long <- cbind(id_age, select(data_n_long, -id))
```

```{r}
add_info <- colsplit(data_n_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_n_long$age <- as.numeric(add_info$age)
data_n_long$group <- as.factor(add_info$group)

# str(data_n_long)
```
```{r}
# unique(data_n_long$age)
```

## AOI = Phone

```{r}
datList <- cbfnp_matlabFile$temporalScores[[2]][[1]][,,3]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_p <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_p) <- datList.un[[3]]
```
```{r}
data_p$time <- datList.un[[4]][,1]
```
```{r}
data_p$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_p[,c(1,ncol(data_p)-1,ncol(data_p))])
```

### Format data

```{r}
# names(data)
data_p_long <- melt(data_p,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.phone"
        )
# str(data_p_long)
```
```{r}
data_p_long <- select(data_p_long, -aoi.name)
id_age <- colsplit(as.character(data_p_long$id), "_", c("id", "age"))
data_p_long <- cbind(id_age, select(data_p_long, -id))
```

```{r}
add_info <- colsplit(data_p_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_p_long$age <- as.numeric(add_info$age)
data_p_long$group <- as.factor(add_info$group)

# str(data_p_long)
```
```{r}
# unique(data_p_long$age)
```

## Merge datasets

```{r}
# dim(data_c_long)
# dim(data_b_long)
```

```{r}
cb <- left_join(data_c_long, data_b_long, by=c("id", "time", "age", "group"))
cbf <- left_join(cb, data_f_long, by=c("id", "time", "age", "group"))
cbfn <- left_join(cbf, data_n_long, by=c("id", "time", "age", "group"))
cbfnp <- left_join(cbfn, data_p_long, by=c("id", "time", "age", "group"))
cbfnp.2 <- cbfnp %>%
  mutate(trial="STATICIMAGES_ONSETPOPOUT2.TIFPOPOUT",
         item=gsub(pattern = "STATICIMAGES_ONSETPOPOUT", 
                    replacement = "",
                    x=trial)) %>%
  mutate(item=as.numeric(gsub(pattern = ".TIFPOPOUT", 
                    replacement = "",
                    x=item))) %>%
  select(id, age, group, time, trial, item, plt.car, plt.bird, plt.face, plt.noise, plt.phone)
head(cbfnp.2)
```

```{r}
rm(list=setdiff(ls(), ls(pattern = "cbfnp")))
```

# Trial 3

## AOI = Car

```{r}
datList <- cbfnp_matlabFile$temporalScores[[3]][[1]][,,2]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
summary(datList.un)
# str(datList.un)
```
```{r}
data_c <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_c) <- datList.un[[3]]
```
```{r}
data_c$time <- datList.un[[4]][,1]
```
```{r}
data_c$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_c[,c(1,ncol(data_c)-1,ncol(data_c))])
```

### Format data

```{r}
# names(data)
data_c_long <- melt(data_c,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.car"
        )
# str(data_c_long)
```
```{r}
data_c_long <- select(data_c_long, -aoi.name)
id_age <- colsplit(as.character(data_c_long$id), "_", c("id", "age"))
data_c_long <- cbind(id_age, select(data_c_long, -id))
```

```{r}
add_info <- colsplit(data_c_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_c_long$age <- as.numeric(add_info$age)
data_c_long$group <- as.factor(add_info$group)

# str(data_c_long)
```
```{r}
# unique(data_c_long$age)
```

## AOI = Bird

```{r}
datList <- cbfnp_matlabFile$temporalScores[[3]][[1]][,,5]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_b <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_b) <- datList.un[[3]]
```
```{r}
data_b$time <- datList.un[[4]][,1]
```
```{r}
data_b$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_b[,c(1,ncol(data_b)-1,ncol(data_b))])
```

### Format data

```{r}
# names(data)
data_b_long <- melt(data_b,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.bird"
        )
# str(data_b_long)
```
```{r}
data_b_long <- select(data_b_long, -aoi.name)
id_age <- colsplit(as.character(data_b_long$id), "_", c("id", "age"))
data_b_long <- cbind(id_age, select(data_b_long, -id))
```

```{r}
add_info <- colsplit(data_b_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_b_long$age <- as.numeric(add_info$age)
data_b_long$group <- as.factor(add_info$group)

# str(data_b_long)
```
```{r}
# unique(data_b_long$age)
```

## AOI = Face

```{r}
datList <- cbfnp_matlabFile$temporalScores[[3]][[1]][,,1]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_f <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_f) <- datList.un[[3]]
```
```{r}
data_f$time <- datList.un[[4]][,1]
```
```{r}
data_f$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_f[,c(1,ncol(data_f)-1,ncol(data_f))])
```

### Format data

```{r}
# names(data)
data_f_long <- melt(data_f,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.face"
        )
# str(data_f_long)
```
```{r}
data_f_long <- select(data_f_long, -aoi.name)
id_age <- colsplit(as.character(data_f_long$id), "_", c("id", "age"))
data_f_long <- cbind(id_age, select(data_f_long, -id))
```

```{r}
add_info <- colsplit(data_f_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_f_long$age <- as.numeric(add_info$age)
data_f_long$group <- as.factor(add_info$group)

# str(data_f_long)
```
```{r}
# unique(data_f_long$age)
```

## AOI = Noise

```{r}
datList <- cbfnp_matlabFile$temporalScores[[3]][[1]][,,4]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_n <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_n) <- datList.un[[3]]
```
```{r}
data_n$time <- datList.un[[4]][,1]
```
```{r}
data_n$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_n[,c(1,ncol(data_n)-1,ncol(data_n))])
```

### Format data

```{r}
# names(data)
data_n_long <- melt(data_n,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.noise"
        )
# str(data_n_long)
```
```{r}
data_n_long <- select(data_n_long, -aoi.name)
id_age <- colsplit(as.character(data_n_long$id), "_", c("id", "age"))
data_n_long <- cbind(id_age, select(data_n_long, -id))
```

```{r}
add_info <- colsplit(data_n_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_n_long$age <- as.numeric(add_info$age)
data_n_long$group <- as.factor(add_info$group)

# str(data_n_long)
```
```{r}
# unique(data_n_long$age)
```

## AOI = Phone

```{r}
datList <- cbfnp_matlabFile$temporalScores[[3]][[1]][,,3]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_p <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_p) <- datList.un[[3]]
```
```{r}
data_p$time <- datList.un[[4]][,1]
```
```{r}
data_p$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_p[,c(1,ncol(data_p)-1,ncol(data_p))])
```

### Format data

```{r}
# names(data)
data_p_long <- melt(data_p,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.phone"
        )
# str(data_p_long)
```
```{r}
data_p_long <- select(data_p_long, -aoi.name)
id_age <- colsplit(as.character(data_p_long$id), "_", c("id", "age"))
data_p_long <- cbind(id_age, select(data_p_long, -id))
```

```{r}
add_info <- colsplit(data_p_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_p_long$age <- as.numeric(add_info$age)
data_p_long$group <- as.factor(add_info$group)

# str(data_p_long)
```
```{r}
# unique(data_p_long$age)
```

## Merge datasets

```{r}
# dim(data_c_long)
# dim(data_b_long)
```

```{r}
cb <- left_join(data_c_long, data_b_long, by=c("id", "time", "age", "group"))
cbf <- left_join(cb, data_f_long, by=c("id", "time", "age", "group"))
cbfn <- left_join(cbf, data_n_long, by=c("id", "time", "age", "group"))
cbfnp <- left_join(cbfn, data_p_long, by=c("id", "time", "age", "group"))
cbfnp.3 <- cbfnp %>%
  mutate(trial="STATICIMAGES_ONSETPOPOUT3.TIFPOPOUT",
         item=gsub(pattern = "STATICIMAGES_ONSETPOPOUT", 
                    replacement = "",
                    x=trial)) %>%
  mutate(item=as.numeric(gsub(pattern = ".TIFPOPOUT", 
                    replacement = "",
                    x=item))) %>%
  select(id, age, group, time, trial, item, plt.car, plt.bird, plt.face, plt.noise, plt.phone)
head(cbfnp.3)
```

```{r}
rm(list=setdiff(ls(), ls(pattern = "cbfnp")))
```





# Trial 4

## AOI = Car

```{r}
datList <- cbfnp_matlabFile$temporalScores[[4]][[1]][,,2]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
summary(datList.un)
# str(datList.un)
```
```{r}
data_c <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_c) <- datList.un[[3]]
```
```{r}
data_c$time <- datList.un[[4]][,1]
```
```{r}
data_c$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_c[,c(1,ncol(data_c)-1,ncol(data_c))])
```

### Format data

```{r}
# names(data)
data_c_long <- melt(data_c,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.car"
        )
# str(data_c_long)
```
```{r}
data_c_long <- select(data_c_long, -aoi.name)
id_age <- colsplit(as.character(data_c_long$id), "_", c("id", "age"))
data_c_long <- cbind(id_age, select(data_c_long, -id))
```

```{r}
add_info <- colsplit(data_c_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_c_long$age <- as.numeric(add_info$age)
data_c_long$group <- as.factor(add_info$group)

# str(data_c_long)
```
```{r}
# unique(data_c_long$age)
```

## AOI = Bird

```{r}
datList <- cbfnp_matlabFile$temporalScores[[4]][[1]][,,5]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_b <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_b) <- datList.un[[3]]
```
```{r}
data_b$time <- datList.un[[4]][,1]
```
```{r}
data_b$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_b[,c(1,ncol(data_b)-1,ncol(data_b))])
```

### Format data

```{r}
# names(data)
data_b_long <- melt(data_b,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.bird"
        )
# str(data_b_long)
```
```{r}
data_b_long <- select(data_b_long, -aoi.name)
id_age <- colsplit(as.character(data_b_long$id), "_", c("id", "age"))
data_b_long <- cbind(id_age, select(data_b_long, -id))
```

```{r}
add_info <- colsplit(data_b_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_b_long$age <- as.numeric(add_info$age)
data_b_long$group <- as.factor(add_info$group)

# str(data_b_long)
```
```{r}
# unique(data_b_long$age)
```

## AOI = Face

```{r}
datList <- cbfnp_matlabFile$temporalScores[[4]][[1]][,,1]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_f <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_f) <- datList.un[[3]]
```
```{r}
data_f$time <- datList.un[[4]][,1]
```
```{r}
data_f$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_f[,c(1,ncol(data_f)-1,ncol(data_f))])
```

### Format data

```{r}
# names(data)
data_f_long <- melt(data_f,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.face"
        )
# str(data_f_long)
```
```{r}
data_f_long <- select(data_f_long, -aoi.name)
id_age <- colsplit(as.character(data_f_long$id), "_", c("id", "age"))
data_f_long <- cbind(id_age, select(data_f_long, -id))
```

```{r}
add_info <- colsplit(data_f_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_f_long$age <- as.numeric(add_info$age)
data_f_long$group <- as.factor(add_info$group)

# str(data_f_long)
```
```{r}
# unique(data_f_long$age)
```

## AOI = Noise

```{r}
datList <- cbfnp_matlabFile$temporalScores[[4]][[1]][,,4]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_n <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_n) <- datList.un[[3]]
```
```{r}
data_n$time <- datList.un[[4]][,1]
```
```{r}
data_n$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_n[,c(1,ncol(data_n)-1,ncol(data_n))])
```

### Format data

```{r}
# names(data)
data_n_long <- melt(data_n,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.noise"
        )
# str(data_n_long)
```
```{r}
data_n_long <- select(data_n_long, -aoi.name)
id_age <- colsplit(as.character(data_n_long$id), "_", c("id", "age"))
data_n_long <- cbind(id_age, select(data_n_long, -id))
```

```{r}
add_info <- colsplit(data_n_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_n_long$age <- as.numeric(add_info$age)
data_n_long$group <- as.factor(add_info$group)

# str(data_n_long)
```
```{r}
# unique(data_n_long$age)
```

## AOI = Phone

```{r}
datList <- cbfnp_matlabFile$temporalScores[[4]][[1]][,,3]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_p <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_p) <- datList.un[[3]]
```
```{r}
data_p$time <- datList.un[[4]][,1]
```
```{r}
data_p$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_p[,c(1,ncol(data_p)-1,ncol(data_p))])
```

### Format data

```{r}
# names(data)
data_p_long <- melt(data_p,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.phone"
        )
# str(data_p_long)
```
```{r}
data_p_long <- select(data_p_long, -aoi.name)
id_age <- colsplit(as.character(data_p_long$id), "_", c("id", "age"))
data_p_long <- cbind(id_age, select(data_p_long, -id))
```

```{r}
add_info <- colsplit(data_p_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_p_long$age <- as.numeric(add_info$age)
data_p_long$group <- as.factor(add_info$group)

# str(data_p_long)
```
```{r}
# unique(data_p_long$age)
```

## Merge datasets

```{r}
# dim(data_c_long)
# dim(data_b_long)
```

```{r}
cb <- left_join(data_c_long, data_b_long, by=c("id", "time", "age", "group"))
cbf <- left_join(cb, data_f_long, by=c("id", "time", "age", "group"))
cbfn <- left_join(cbf, data_n_long, by=c("id", "time", "age", "group"))
cbfnp <- left_join(cbfn, data_p_long, by=c("id", "time", "age", "group"))
cbfnp.4 <- cbfnp %>%
  mutate(trial="STATICIMAGES_ONSETPOPOUT4.TIFPOPOUT",
         item=gsub(pattern = "STATICIMAGES_ONSETPOPOUT", 
                    replacement = "",
                    x=trial)) %>%
  mutate(item=as.numeric(gsub(pattern = ".TIFPOPOUT", 
                    replacement = "",
                    x=item))) %>%
  select(id, age, group, time, trial, item, plt.car, plt.bird, plt.face, plt.noise, plt.phone)
head(cbfnp.4)
```

```{r}
rm(list=setdiff(ls(), ls(pattern = "cbfnp")))
```

# Trial 5

## AOI = Car

```{r}
datList <- cbfnp_matlabFile$temporalScores[[5]][[1]][,,2]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
summary(datList.un)
# str(datList.un)
```
```{r}
data_c <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_c) <- datList.un[[3]]
```
```{r}
data_c$time <- datList.un[[4]][,1]
```
```{r}
data_c$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_c[,c(1,ncol(data_c)-1,ncol(data_c))])
```

### Format data

```{r}
# names(data)
data_c_long <- melt(data_c,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.car"
        )
# str(data_c_long)
```
```{r}
data_c_long <- select(data_c_long, -aoi.name)
id_age <- colsplit(as.character(data_c_long$id), "_", c("id", "age"))
data_c_long <- cbind(id_age, select(data_c_long, -id))
```

```{r}
add_info <- colsplit(data_c_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_c_long$age <- as.numeric(add_info$age)
data_c_long$group <- as.factor(add_info$group)

# str(data_c_long)
```
```{r}
# unique(data_c_long$age)
```

## AOI = Bird

```{r}
datList <- cbfnp_matlabFile$temporalScores[[5]][[1]][,,5]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_b <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_b) <- datList.un[[3]]
```
```{r}
data_b$time <- datList.un[[4]][,1]
```
```{r}
data_b$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_b[,c(1,ncol(data_b)-1,ncol(data_b))])
```

### Format data

```{r}
# names(data)
data_b_long <- melt(data_b,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.bird"
        )
# str(data_b_long)
```
```{r}
data_b_long <- select(data_b_long, -aoi.name)
id_age <- colsplit(as.character(data_b_long$id), "_", c("id", "age"))
data_b_long <- cbind(id_age, select(data_b_long, -id))
```

```{r}
add_info <- colsplit(data_b_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_b_long$age <- as.numeric(add_info$age)
data_b_long$group <- as.factor(add_info$group)

# str(data_b_long)
```
```{r}
# unique(data_b_long$age)
```

## AOI = Face

```{r}
datList <- cbfnp_matlabFile$temporalScores[[5]][[1]][,,1]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_f <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_f) <- datList.un[[3]]
```
```{r}
data_f$time <- datList.un[[4]][,1]
```
```{r}
data_f$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_f[,c(1,ncol(data_f)-1,ncol(data_f))])
```

### Format data

```{r}
# names(data)
data_f_long <- melt(data_f,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.face"
        )
# str(data_f_long)
```
```{r}
data_f_long <- select(data_f_long, -aoi.name)
id_age <- colsplit(as.character(data_f_long$id), "_", c("id", "age"))
data_f_long <- cbind(id_age, select(data_f_long, -id))
```

```{r}
add_info <- colsplit(data_f_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_f_long$age <- as.numeric(add_info$age)
data_f_long$group <- as.factor(add_info$group)

# str(data_f_long)
```
```{r}
# unique(data_f_long$age)
```

## AOI = Noise

```{r}
datList <- cbfnp_matlabFile$temporalScores[[5]][[1]][,,4]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_n <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_n) <- datList.un[[3]]
```
```{r}
data_n$time <- datList.un[[4]][,1]
```
```{r}
data_n$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_n[,c(1,ncol(data_n)-1,ncol(data_n))])
```

### Format data

```{r}
# names(data)
data_n_long <- melt(data_n,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.noise"
        )
# str(data_n_long)
```
```{r}
data_n_long <- select(data_n_long, -aoi.name)
id_age <- colsplit(as.character(data_n_long$id), "_", c("id", "age"))
data_n_long <- cbind(id_age, select(data_n_long, -id))
```

```{r}
add_info <- colsplit(data_n_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_n_long$age <- as.numeric(add_info$age)
data_n_long$group <- as.factor(add_info$group)

# str(data_n_long)
```
```{r}
# unique(data_n_long$age)
```

## AOI = Phone

```{r}
datList <- cbfnp_matlabFile$temporalScores[[5]][[1]][,,3]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_p <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_p) <- datList.un[[3]]
```
```{r}
data_p$time <- datList.un[[4]][,1]
```
```{r}
data_p$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_p[,c(1,ncol(data_p)-1,ncol(data_p))])
```

### Format data

```{r}
# names(data)
data_p_long <- melt(data_p,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.phone"
        )
# str(data_p_long)
```
```{r}
data_p_long <- select(data_p_long, -aoi.name)
id_age <- colsplit(as.character(data_p_long$id), "_", c("id", "age"))
data_p_long <- cbind(id_age, select(data_p_long, -id))
```

```{r}
add_info <- colsplit(data_p_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_p_long$age <- as.numeric(add_info$age)
data_p_long$group <- as.factor(add_info$group)

# str(data_p_long)
```
```{r}
# unique(data_p_long$age)
```

## Merge datasets

```{r}
# dim(data_c_long)
# dim(data_b_long)
```

```{r}
cb <- left_join(data_c_long, data_b_long, by=c("id", "time", "age", "group"))
cbf <- left_join(cb, data_f_long, by=c("id", "time", "age", "group"))
cbfn <- left_join(cbf, data_n_long, by=c("id", "time", "age", "group"))
cbfnp <- left_join(cbfn, data_p_long, by=c("id", "time", "age", "group"))
cbfnp.5 <- cbfnp %>%
  mutate(trial="STATICIMAGES_ONSETPOPOUT5.TIFPOPOUT",
         item=gsub(pattern = "STATICIMAGES_ONSETPOPOUT", 
                    replacement = "",
                    x=trial)) %>%
  mutate(item=as.numeric(gsub(pattern = ".TIFPOPOUT", 
                    replacement = "",
                    x=item))) %>%
  select(id, age, group, time, trial, item, plt.car, plt.bird, plt.face, plt.noise, plt.phone)
head(cbfnp.5)
```

```{r}
rm(list=setdiff(ls(), ls(pattern = "cbfnp")))
```

# Trial 6

## AOI = Car

```{r}
datList <- cbfnp_matlabFile$temporalScores[[6]][[1]][,,2]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
summary(datList.un)
# str(datList.un)
```
```{r}
data_c <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_c) <- datList.un[[3]]
```
```{r}
data_c$time <- datList.un[[4]][,1]
```
```{r}
data_c$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_c[,c(1,ncol(data_c)-1,ncol(data_c))])
```

### Format data

```{r}
# names(data)
data_c_long <- melt(data_c,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.car"
        )
# str(data_c_long)
```
```{r}
data_c_long <- select(data_c_long, -aoi.name)
id_age <- colsplit(as.character(data_c_long$id), "_", c("id", "age"))
data_c_long <- cbind(id_age, select(data_c_long, -id))
```

```{r}
add_info <- colsplit(data_c_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_c_long$age <- as.numeric(add_info$age)
data_c_long$group <- as.factor(add_info$group)

# str(data_c_long)
```
```{r}
# unique(data_c_long$age)
```

## AOI = Bird

```{r}
datList <- cbfnp_matlabFile$temporalScores[[6]][[1]][,,5]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_b <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_b) <- datList.un[[3]]
```
```{r}
data_b$time <- datList.un[[4]][,1]
```
```{r}
data_b$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_b[,c(1,ncol(data_b)-1,ncol(data_b))])
```

### Format data

```{r}
# names(data)
data_b_long <- melt(data_b,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.bird"
        )
# str(data_b_long)
```
```{r}
data_b_long <- select(data_b_long, -aoi.name)
id_age <- colsplit(as.character(data_b_long$id), "_", c("id", "age"))
data_b_long <- cbind(id_age, select(data_b_long, -id))
```

```{r}
add_info <- colsplit(data_b_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_b_long$age <- as.numeric(add_info$age)
data_b_long$group <- as.factor(add_info$group)

# str(data_b_long)
```
```{r}
# unique(data_b_long$age)
```

## AOI = Face

```{r}
datList <- cbfnp_matlabFile$temporalScores[[6]][[1]][,,1]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_f <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_f) <- datList.un[[3]]
```
```{r}
data_f$time <- datList.un[[4]][,1]
```
```{r}
data_f$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_f[,c(1,ncol(data_f)-1,ncol(data_f))])
```

### Format data

```{r}
# names(data)
data_f_long <- melt(data_f,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.face"
        )
# str(data_f_long)
```
```{r}
data_f_long <- select(data_f_long, -aoi.name)
id_age <- colsplit(as.character(data_f_long$id), "_", c("id", "age"))
data_f_long <- cbind(id_age, select(data_f_long, -id))
```

```{r}
add_info <- colsplit(data_f_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_f_long$age <- as.numeric(add_info$age)
data_f_long$group <- as.factor(add_info$group)

# str(data_f_long)
```
```{r}
# unique(data_f_long$age)
```

## AOI = Noise

```{r}
datList <- cbfnp_matlabFile$temporalScores[[6]][[1]][,,4]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_n <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_n) <- datList.un[[3]]
```
```{r}
data_n$time <- datList.un[[4]][,1]
```
```{r}
data_n$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_n[,c(1,ncol(data_n)-1,ncol(data_n))])
```

### Format data

```{r}
# names(data)
data_n_long <- melt(data_n,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.noise"
        )
# str(data_n_long)
```
```{r}
data_n_long <- select(data_n_long, -aoi.name)
id_age <- colsplit(as.character(data_n_long$id), "_", c("id", "age"))
data_n_long <- cbind(id_age, select(data_n_long, -id))
```

```{r}
add_info <- colsplit(data_n_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_n_long$age <- as.numeric(add_info$age)
data_n_long$group <- as.factor(add_info$group)

# str(data_n_long)
```
```{r}
# unique(data_n_long$age)
```

## AOI = Phone

```{r}
datList <- cbfnp_matlabFile$temporalScores[[6]][[1]][,,3]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_p <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_p) <- datList.un[[3]]
```
```{r}
data_p$time <- datList.un[[4]][,1]
```
```{r}
data_p$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_p[,c(1,ncol(data_p)-1,ncol(data_p))])
```

### Format data

```{r}
# names(data)
data_p_long <- melt(data_p,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.phone"
        )
# str(data_p_long)
```
```{r}
data_p_long <- select(data_p_long, -aoi.name)
id_age <- colsplit(as.character(data_p_long$id), "_", c("id", "age"))
data_p_long <- cbind(id_age, select(data_p_long, -id))
```

```{r}
add_info <- colsplit(data_p_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_p_long$age <- as.numeric(add_info$age)
data_p_long$group <- as.factor(add_info$group)

# str(data_p_long)
```
```{r}
# unique(data_p_long$age)
```

## Merge datasets

```{r}
# dim(data_c_long)
# dim(data_b_long)
```

```{r}
cb <- left_join(data_c_long, data_b_long, by=c("id", "time", "age", "group"))
cbf <- left_join(cb, data_f_long, by=c("id", "time", "age", "group"))
cbfn <- left_join(cbf, data_n_long, by=c("id", "time", "age", "group"))
cbfnp <- left_join(cbfn, data_p_long, by=c("id", "time", "age", "group"))
cbfnp.6 <- cbfnp %>%
  mutate(trial="STATICIMAGES_ONSETPOPOUT6.TIFPOPOUT",
         item=gsub(pattern = "STATICIMAGES_ONSETPOPOUT", 
                    replacement = "",
                    x=trial)) %>%
  mutate(item=as.numeric(gsub(pattern = ".TIFPOPOUT", 
                    replacement = "",
                    x=item))) %>%
  select(id, age, group, time, trial, item, plt.car, plt.bird, plt.face, plt.noise, plt.phone)
head(cbfnp.6)
```

```{r}
rm(list=setdiff(ls(), ls(pattern = "cbfnp")))
```

# Trial 7

## AOI = Car

```{r}
datList <- cbfnp_matlabFile$temporalScores[[7]][[1]][,,2]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
summary(datList.un)
# str(datList.un)
```
```{r}
data_c <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_c) <- datList.un[[3]]
```
```{r}
data_c$time <- datList.un[[4]][,1]
```
```{r}
data_c$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_c[,c(1,ncol(data_c)-1,ncol(data_c))])
```

### Format data

```{r}
# names(data)
data_c_long <- melt(data_c,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.car"
        )
# str(data_c_long)
```
```{r}
data_c_long <- select(data_c_long, -aoi.name)
id_age <- colsplit(as.character(data_c_long$id), "_", c("id", "age"))
data_c_long <- cbind(id_age, select(data_c_long, -id))
```

```{r}
add_info <- colsplit(data_c_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_c_long$age <- as.numeric(add_info$age)
data_c_long$group <- as.factor(add_info$group)

# str(data_c_long)
```
```{r}
# unique(data_c_long$age)
```

## AOI = Bird

```{r}
datList <- cbfnp_matlabFile$temporalScores[[7]][[1]][,,5]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_b <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_b) <- datList.un[[3]]
```
```{r}
data_b$time <- datList.un[[4]][,1]
```
```{r}
data_b$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_b[,c(1,ncol(data_b)-1,ncol(data_b))])
```

### Format data

```{r}
# names(data)
data_b_long <- melt(data_b,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.bird"
        )
# str(data_b_long)
```
```{r}
data_b_long <- select(data_b_long, -aoi.name)
id_age <- colsplit(as.character(data_b_long$id), "_", c("id", "age"))
data_b_long <- cbind(id_age, select(data_b_long, -id))
```

```{r}
add_info <- colsplit(data_b_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_b_long$age <- as.numeric(add_info$age)
data_b_long$group <- as.factor(add_info$group)

# str(data_b_long)
```
```{r}
# unique(data_b_long$age)
```

## AOI = Face

```{r}
datList <- cbfnp_matlabFile$temporalScores[[7]][[1]][,,1]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_f <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_f) <- datList.un[[3]]
```
```{r}
data_f$time <- datList.un[[4]][,1]
```
```{r}
data_f$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_f[,c(1,ncol(data_f)-1,ncol(data_f))])
```

### Format data

```{r}
# names(data)
data_f_long <- melt(data_f,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.face"
        )
# str(data_f_long)
```
```{r}
data_f_long <- select(data_f_long, -aoi.name)
id_age <- colsplit(as.character(data_f_long$id), "_", c("id", "age"))
data_f_long <- cbind(id_age, select(data_f_long, -id))
```

```{r}
add_info <- colsplit(data_f_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_f_long$age <- as.numeric(add_info$age)
data_f_long$group <- as.factor(add_info$group)

# str(data_f_long)
```
```{r}
# unique(data_f_long$age)
```

## AOI = Noise

```{r}
datList <- cbfnp_matlabFile$temporalScores[[7]][[1]][,,4]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_n <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_n) <- datList.un[[3]]
```
```{r}
data_n$time <- datList.un[[4]][,1]
```
```{r}
data_n$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_n[,c(1,ncol(data_n)-1,ncol(data_n))])
```

### Format data

```{r}
# names(data)
data_n_long <- melt(data_n,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.noise"
        )
# str(data_n_long)
```
```{r}
data_n_long <- select(data_n_long, -aoi.name)
id_age <- colsplit(as.character(data_n_long$id), "_", c("id", "age"))
data_n_long <- cbind(id_age, select(data_n_long, -id))
```

```{r}
add_info <- colsplit(data_n_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_n_long$age <- as.numeric(add_info$age)
data_n_long$group <- as.factor(add_info$group)

# str(data_n_long)
```
```{r}
# unique(data_n_long$age)
```

## AOI = Phone

```{r}
datList <- cbfnp_matlabFile$temporalScores[[7]][[1]][,,3]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_p <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_p) <- datList.un[[3]]
```
```{r}
data_p$time <- datList.un[[4]][,1]
```
```{r}
data_p$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_p[,c(1,ncol(data_p)-1,ncol(data_p))])
```

### Format data

```{r}
# names(data)
data_p_long <- melt(data_p,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.phone"
        )
# str(data_p_long)
```
```{r}
data_p_long <- select(data_p_long, -aoi.name)
id_age <- colsplit(as.character(data_p_long$id), "_", c("id", "age"))
data_p_long <- cbind(id_age, select(data_p_long, -id))
```

```{r}
add_info <- colsplit(data_p_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_p_long$age <- as.numeric(add_info$age)
data_p_long$group <- as.factor(add_info$group)

# str(data_p_long)
```
```{r}
# unique(data_p_long$age)
```

## Merge datasets

```{r}
# dim(data_c_long)
# dim(data_b_long)
```

```{r}
cb <- left_join(data_c_long, data_b_long, by=c("id", "time", "age", "group"))
cbf <- left_join(cb, data_f_long, by=c("id", "time", "age", "group"))
cbfn <- left_join(cbf, data_n_long, by=c("id", "time", "age", "group"))
cbfnp <- left_join(cbfn, data_p_long, by=c("id", "time", "age", "group"))
cbfnp.7 <- cbfnp %>%
  mutate(trial="STATICIMAGES_ONSETPOPOUT7.TIFPOPOUT",
         item=gsub(pattern = "STATICIMAGES_ONSETPOPOUT", 
                    replacement = "",
                    x=trial)) %>%
  mutate(item=as.numeric(gsub(pattern = ".TIFPOPOUT", 
                    replacement = "",
                    x=item))) %>%
  select(id, age, group, time, trial, item, plt.car, plt.bird, plt.face, plt.noise, plt.phone)
head(cbfnp.7)
```

```{r}
rm(list=setdiff(ls(), ls(pattern = "cbfnp")))
```

# Trial 8

## AOI = Car

```{r}
datList <- cbfnp_matlabFile$temporalScores[[8]][[1]][,,2]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
summary(datList.un)
# str(datList.un)
```
```{r}
data_c <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_c) <- datList.un[[3]]
```
```{r}
data_c$time <- datList.un[[4]][,1]
```
```{r}
data_c$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_c[,c(1,ncol(data_c)-1,ncol(data_c))])
```

### Format data

```{r}
# names(data)
data_c_long <- melt(data_c,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.car"
        )
# str(data_c_long)
```
```{r}
data_c_long <- select(data_c_long, -aoi.name)
id_age <- colsplit(as.character(data_c_long$id), "_", c("id", "age"))
data_c_long <- cbind(id_age, select(data_c_long, -id))
```

```{r}
add_info <- colsplit(data_c_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_c_long$age <- as.numeric(add_info$age)
data_c_long$group <- as.factor(add_info$group)

# str(data_c_long)
```
```{r}
# unique(data_c_long$age)
```

## AOI = Bird

```{r}
datList <- cbfnp_matlabFile$temporalScores[[8]][[1]][,,5]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_b <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_b) <- datList.un[[3]]
```
```{r}
data_b$time <- datList.un[[4]][,1]
```
```{r}
data_b$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_b[,c(1,ncol(data_b)-1,ncol(data_b))])
```

### Format data

```{r}
# names(data)
data_b_long <- melt(data_b,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.bird"
        )
# str(data_b_long)
```
```{r}
data_b_long <- select(data_b_long, -aoi.name)
id_age <- colsplit(as.character(data_b_long$id), "_", c("id", "age"))
data_b_long <- cbind(id_age, select(data_b_long, -id))
```

```{r}
add_info <- colsplit(data_b_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_b_long$age <- as.numeric(add_info$age)
data_b_long$group <- as.factor(add_info$group)

# str(data_b_long)
```
```{r}
# unique(data_b_long$age)
```

## AOI = Face

```{r}
datList <- cbfnp_matlabFile$temporalScores[[8]][[1]][,,1]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_f <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_f) <- datList.un[[3]]
```
```{r}
data_f$time <- datList.un[[4]][,1]
```
```{r}
data_f$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_f[,c(1,ncol(data_f)-1,ncol(data_f))])
```

### Format data

```{r}
# names(data)
data_f_long <- melt(data_f,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.face"
        )
# str(data_f_long)
```
```{r}
data_f_long <- select(data_f_long, -aoi.name)
id_age <- colsplit(as.character(data_f_long$id), "_", c("id", "age"))
data_f_long <- cbind(id_age, select(data_f_long, -id))
```

```{r}
add_info <- colsplit(data_f_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_f_long$age <- as.numeric(add_info$age)
data_f_long$group <- as.factor(add_info$group)

# str(data_f_long)
```
```{r}
# unique(data_f_long$age)
```

## AOI = Noise

```{r}
datList <- cbfnp_matlabFile$temporalScores[[8]][[1]][,,4]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_n <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_n) <- datList.un[[3]]
```
```{r}
data_n$time <- datList.un[[4]][,1]
```
```{r}
data_n$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_n[,c(1,ncol(data_n)-1,ncol(data_n))])
```

### Format data

```{r}
# names(data)
data_n_long <- melt(data_n,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.noise"
        )
# str(data_n_long)
```
```{r}
data_n_long <- select(data_n_long, -aoi.name)
id_age <- colsplit(as.character(data_n_long$id), "_", c("id", "age"))
data_n_long <- cbind(id_age, select(data_n_long, -id))
```

```{r}
add_info <- colsplit(data_n_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_n_long$age <- as.numeric(add_info$age)
data_n_long$group <- as.factor(add_info$group)

# str(data_n_long)
```
```{r}
# unique(data_n_long$age)
```

## AOI = Phone

```{r}
datList <- cbfnp_matlabFile$temporalScores[[8]][[1]][,,3]
# summary(datList)
```
```{r}
datList.un <- lapply(datList, unlist, use.names=FALSE)
# summary(datList.un)
# str(datList.un)
```
```{r}
data_p <- as.data.frame(datList.un[[2]])
```
```{r}
names(data_p) <- datList.un[[3]]
```
```{r}
data_p$time <- datList.un[[4]][,1]
```
```{r}
data_p$aoi.name <- datList.un[[1]][,1]
```
```{r}
# head(data_p[,c(1,ncol(data_p)-1,ncol(data_p))])
```

### Format data

```{r}
# names(data)
data_p_long <- melt(data_p,
        # ID variables - all the variables to keep but not split apart on
        id.vars=c("time", "aoi.name"),
        # The source columns
        # measure.vars=c("control", "cond1", "cond2" ),
        # Name of the destination column that will identify the original
        # column that the measurement came from
        variable.name="id",
        value.name="plt.phone"
        )
# str(data_p_long)
```
```{r}
data_p_long <- select(data_p_long, -aoi.name)
id_age <- colsplit(as.character(data_p_long$id), "_", c("id", "age"))
data_p_long <- cbind(id_age, select(data_p_long, -id))
```

```{r}
add_info <- colsplit(data_p_long$age, "m", c("age.t", "group.t"))
# unique(add_info)

add_info$group <- ifelse(add_info$age.t=="IS2_14", "IS2_COMB",
                         ifelse(add_info$group.t=="", NA, add_info$group.t))
# unique(add_info)

add_info$age <- ifelse(add_info$age.t=="IS2_14", "14", add_info$age.t)
# unique(add_info)

data_p_long$age <- as.numeric(add_info$age)
data_p_long$group <- as.factor(add_info$group)

# str(data_p_long)
```
```{r}
# unique(data_p_long$age)
```

## Merge datasets

```{r}
# dim(data_c_long)
# dim(data_b_long)
```

```{r}
cb <- left_join(data_c_long, data_b_long, by=c("id", "time", "age", "group"))
cbf <- left_join(cb, data_f_long, by=c("id", "time", "age", "group"))
cbfn <- left_join(cbf, data_n_long, by=c("id", "time", "age", "group"))
cbfnp <- left_join(cbfn, data_p_long, by=c("id", "time", "age", "group"))
cbfnp.8 <- cbfnp %>%
  mutate(trial="STATICIMAGES_ONSETPOPOUT8.TIFPOPOUT",
         item=gsub(pattern = "STATICIMAGES_ONSETPOPOUT", 
                    replacement = "",
                    x=trial)) %>%
  mutate(item=as.numeric(gsub(pattern = ".TIFPOPOUT", 
                    replacement = "",
                    x=item))) %>%
  select(id, age, group, time, trial, item, plt.car, plt.bird, plt.face, plt.noise, plt.phone)
head(cbfnp.8)
```

```{r}
rm(list=setdiff(ls(), ls(pattern = "cbfnp")))
```

# Attach datasets together

```{r}
cbfnp <- rbind(cbfnp.1,
               cbfnp.2,
               cbfnp.3,
               cbfnp.4,
               cbfnp.5,
               cbfnp.6,
               cbfnp.7,
               cbfnp.8)
```

# Read risk group info

```{r}
rg <- read.csv("Datasets/rg.csv")
str(rg)
rg <- rg %>%
  mutate(id=paste0("A", ID)) %>%
  select(-ID)
```

# Select only Phase 3 Infant Data

```{r}
cbfnp.ph3 <- cbfnp %>%
  inner_join(rg, by="id")
```

```{r}
length(unique(cbfnp.ph3$id))
```

# Remove ADHD Risk Only

```{r}
cbfnp.ph3.asd <- cbfnp.ph3 %>%
  filter(!(ASD==0 & ADHD==1))
```

# Save the big dataset

```{r}
save(cbfnp, cbfnp.ph3, cbfnp.ph3.asd, file = "SavedWS/cbfnp.RData")
```


































