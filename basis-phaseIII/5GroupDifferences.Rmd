---
title: "Results - Group Differences"
author: "Teresa Del Bianco"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
# Load packages
packs <- c("reshape2", "dplyr", "ggplot2", "lmerTest", "broom.mixed", "car", "knitr", "stringi", "tidyr", "sjPlot", "sjlabelled", "sjmisc", "gganimate", "ggpubr")
lapply(packs, require, character.only = TRUE)
```
```{r, include = FALSE}
load("SavedWS/sel-model.RData")
```

# Fixed Effects

## Only AGE

```{r, include=FALSE}
# confidence intervals
set.seed(88)
ci <- confint(m_3_t_a, method="Wald")
ci <- data.frame(ci[-c(1:12),])
ci <- ci %>% tibble::rownames_to_column("term")
```

```{r, include=FALSE}
# estimates
est <- data.frame(summary(m_3_t_a)$coef)
est_face <- est %>% 
  add_rownames("term") %>%
  inner_join(ci, by="term") %>%
  rename("p.value"=Pr...t..,
         "st.error"=Std..Error,
         "CI_2.5"=X2.5..,
         "CI_97.5"=X97.5..) %>%
  mutate(Sign=ifelse(p.value<0.001, "**", 
                     ifelse(p.value<0.05, "*",
                            ifelse(p.value < 0.1, ".", "-"))),
         Estimate=100*Estimate,
         st.error=100*st.error,
         CI_2.5=100*CI_2.5,
         CI_97.5=100*CI_97.5) %>%
  mutate_each(funs(round(.,2)), -term, -Sign)
est_face
```

```{r, echo=FALSE}
kable(est_face, caption = "Estimates of fixed effects and 95% confidence intervals")
```

# Random Effect

```{r, include=FALSE}
re.id <- VarCorr(m_3_t_a, digits=2)[1]$`id`
re.item <- VarCorr(m_3_t_a, digits=2)[2]$`item`
stdev.residual <- c(round(sigma(m_3_t_a), 2), NA, NA, NA)
```
```{r, include=FALSE}

stdev.id <- round(attributes(re.id)$stddev, 2)
stdev.item <- c(round(attributes(re.item)$stddev, 2), NA, NA, NA)
re <- tidy(rbind(stdev.id, stdev.item, stdev.residual))
colnames(re) <- c("Term", "Intercept", "Slope", "Quadratic", "Cubic")
re 
```

```{r, echo=FALSE}
kable(re, caption = "Standard deviations of the random effects")
```

# Group Comparisons

Report key findings in the text as appropriate: 
T-test and Anova: Test statistics, degrees of freedom and significance tests (F/T() = , p < )
Simultaneous Tests for General Linear hypotheses: Estimate, Standard error and significance test (Estimate = , SE = , p < )

```{r, include=FALSE}
overall.anv <- Anova(m_3_t_a, 
                     contrasts=list(topic=contr.sum, 
                                    sys=contr.sum), 
                     type=3) %>% 
  tidy() %>%
  mutate(Sign=ifelse(p.value<0.001, "**", 
                     ifelse(p.value<0.05, "*",
                            ifelse(p.value < 0.1, ".", "-")))) %>%
  mutate_each(funs(round(.,2)), -term, -Sign)
```

```{r, echo=FALSE}
kable(overall.anv, caption="Overall difference between groups")
```

# Data Visualisation

```{r, include=FALSE}
new.data <- expand.grid(age=unique(data.aggr.0.5.rg.clean$age),
                        item=unique(data.aggr.0.5.rg.clean$item),
                        block.05=unique(data.aggr.0.5.rg.clean$block.05),
                        id=1)
t <- poly((unique(new.data$block.05)), 4)
new.data[,paste("ot", 1:4, sep="")] <- t[new.data$block.05, 1:4]
new.data$pred <- predict(m_3_t_a, new.data, allow.new.levels = TRUE)
new.data <- arrange(new.data, age)
```

```{r, include=FALSE}
# Source: https://github.com/dgrtwo/gganimate
# install.packages("cowplot")  # a gganimate dependency
# devtools::install_github("dgrtwo/gganimate")

# theme_set(theme_bw())  # pre-set the bw theme.

# g <- new.data %>%
#   # filter(t1_ageyrs==6) %>%
#   ggplot(aes(x = block.05/2, y = pred, 
#              group=age, col=factor(age),
#              fill=factor(age))) +
#   
#   stat_summary(fun.y="mean", geom="point",
#                data=data.aggr.0.5,
#                aes(y=m.plt.face,
#                    x=block.05/2,
#                    col=as.factor(age)),
#                position=position_dodge(0.1)) +
#   stat_summary(fun.data="mean_se", geom="errorbar",
#                data=data.aggr.0.5,
#                aes(y=m.plt.face,
#                    x=block.05/2,
#                    col=as.factor(age)),
#                position=position_dodge(0.1)) +
# 
#   
#   stat_summary(fun.data = "mean_ci", geom="ribbon", alpha=0.2) +
#   stat_summary(fun.y = "mean", geom="path") +
#   labs(x="Time in Trial (s)", 
#        y="Proportional Looking Time", 
#        fill="Age (months)", 
#        color="Age (months)",
#        caption="AOI: FACE")
# g
# ggsave(g, file="Plots/pred-plot.pdf", width = 9)
# g.an <- g + transition_states(factor(age)) +  ggtitle('Age: {closest_state} months')
# g.an
# anim_save("Plots/plt-by-age-anim.gif")
```

# Prediction Intervals

```{r}
library(merTools)
set.seed(88)
prediction_int_byage <- predictInterval(m_3_t_a, 
                newdata=new.data, 
                which = "full", #"full", "fixed", "random", "all"
                level = 0.95, n.sims = 1000, 
                stat = "mean", #"median", "mean"
                type = "linear.prediction", #"linear.prediction", "probability"
                include.resid.var = FALSE, 
                returnSims = FALSE, 
                seed = NULL,
                fix.intercept.variance = FALSE)
new.data <- cbind(new.data, prediction_int_byage)
```

```{r}
g_face <- new.data %>%
  # filter(t1_ageyrs==6) %>%
  ggplot(aes(x = block.05/4, y = fit, 
             group=age, col=as.factor(age),
             fill=as.factor(age))) +
  
  stat_summary(fun.y="mean", geom="point",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.face,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +
  stat_summary(fun.data="mean_se", geom="errorbar",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.face,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +

  
  stat_summary(aes(ymin=lwr, ymax=upr),
    fun.data = "mean_ci", geom="ribbon", alpha=0.2) +
  stat_summary(fun.y = "mean", geom="path") +
  labs(x="Time in Trial (s)", 
       y="Proportional Looking Time", 
       fill="Age (months)", 
       color="Age (months)",
       caption="")
g_face
# ggsave(g_face, file="Plots/fit-pred-int-face.pdf", width = 9)
# ggsave(g_face, file="Plots/fit-pred-int-face.jpg", width = 9)

```

## Gender

```{r, include=FALSE}
# confidence intervals
set.seed(88)
ci <- confint(m_3_t_a_sex_int, method="Wald")
ci <- data.frame(ci[-c(1:12),])
ci <- ci %>% tibble::rownames_to_column("term")
```

```{r, include=FALSE}
# estimates
est <- data.frame(summary(m_3_t_a_sex_int)$coef)
est_face_sex <- est %>% 
  add_rownames("term") %>%
  inner_join(ci, by="term") %>%
  rename("p.value"=Pr...t..,
         "st.error"=Std..Error,
         "CI_2.5"=X2.5..,
         "CI_97.5"=X97.5..) %>%
  mutate(Sign=ifelse(p.value<0.001, "**", 
                     ifelse(p.value<0.05, "*",
                            ifelse(p.value < 0.1, ".", "-"))),
         Estimate=100*Estimate,
         st.error=100*st.error,
         CI_2.5=100*CI_2.5,
         CI_97.5=100*CI_97.5) %>%
  mutate_each(funs(round(.,2)), -term, -Sign)
est_face_sex
```

# Data Visualisation

```{r, include=FALSE}
new.data <- expand.grid(age=unique(data.aggr.0.5.rg.clean$age),
                        item=unique(data.aggr.0.5.rg.clean$item),
                        block.05=unique(data.aggr.0.5.rg.clean$block.05),
                        sex=unique(data.aggr.0.5.rg.clean$sex),
                        id=1)
t <- poly((unique(new.data$block.05)), 3)
new.data[,paste("ot", 1:3, sep="")] <- t[new.data$block.05, 1:3]
new.data <- arrange(new.data, age)
```

# Prediction Intervals

```{r}
library(merTools)
set.seed(88)
prediction_int_bysex <- predictInterval(m_3_t_a_sex_int, 
                newdata=new.data, 
                which = "full", #"full", "fixed", "random", "all"
                level = 0.95, n.sims = 1000, 
                stat = "mean", #"median", "mean"
                type = "linear.prediction", #"linear.prediction", "probability"
                include.resid.var = FALSE, 
                returnSims = FALSE, 
                seed = NULL,
                fix.intercept.variance = FALSE)
new.data <- cbind(new.data, prediction_int_bysex)
```

```{r}
g_face_sex <- new.data %>%
  # filter(t1_ageyrs==6) %>%
  ggplot(aes(x = block.05/4, y = fit, 
             group=age, col=as.factor(age),
             fill=as.factor(age))) +
  
  stat_summary(fun.y="mean", geom="point",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.face,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +
  stat_summary(fun.data="mean_se", geom="errorbar",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.face,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +

  
  stat_summary(aes(ymin=lwr, ymax=upr),
    fun.data = "mean_ci", geom="ribbon", alpha=0.2) +
  stat_summary(fun.y = "mean", geom="path") +
  labs(x="Time in Trial (s)", 
       y="Proportional Looking Time", 
       fill="Age (months)", 
       color="Age (months)",
       caption="AOI: FACE") +
  facet_wrap(~sex)
g_face_sex
# ggsave(g_face_sex, file="Plots/fit-pred-int-sex.pdf", width = 9)
# ggsave(g_face_sex, file="Plots/fit-pred-int-sex.jpg", width = 9)

```

## Gender*RG

```{r, include=FALSE}
# confidence intervals
set.seed(88)
ci <- confint(m_3_t_a_rg3_comp, method="Wald")
ci <- data.frame(ci[-c(1:12),])
ci <- ci %>% tibble::rownames_to_column("term")
```

```{r, include=FALSE}
# estimates
est <- data.frame(summary(m_3_t_a_rg3_comp)$coef)
est_face_sex_rg <- est %>% 
  add_rownames("term") %>%
  inner_join(ci, by="term") %>%
  rename("p.value"=Pr...t..,
         "st.error"=Std..Error,
         "CI_2.5"=X2.5..,
         "CI_97.5"=X97.5..) %>%
  mutate(Sign=ifelse(p.value<0.001, "**", 
                     ifelse(p.value<0.05, "*",
                            ifelse(p.value < 0.1, ".", "-"))),
         Estimate=100*Estimate,
         st.error=100*st.error,
         CI_2.5=100*CI_2.5,
         CI_97.5=100*CI_97.5) %>%
  mutate_each(funs(round(.,2)), -term, -Sign)
```

# Data Visualisation

```{r, include=FALSE}
new.data.all <- expand.grid(age=unique(data.aggr.0.5.rg.clean$age),
                        item=unique(data.aggr.0.5.rg.clean$item),
                        block.05=unique(data.aggr.0.5.rg.clean$block.05),
                        sex=unique(data.aggr.0.5.rg.clean$sex),
                        ASD=unique(data.aggr.0.5.rg.clean$ASD),
                        ADHD=unique(data.aggr.0.5.rg.clean$ADHD),
                        id=1)
t <- poly((unique(new.data.all$block.05)), 3)
new.data.all[,paste("ot", 1:3, sep="")] <- t[new.data.all$block.05, 1:3]
new.data.all <- arrange(new.data.all, age)
```

# Prediction Intervals

```{r}
library(merTools)
set.seed(88)
prediction_int_bysex_rg <- predictInterval(m_3_t_a_rg3_comp, 
                newdata=new.data.all, 
                which = "full", #"full", "fixed", "random", "all"
                level = 0.95, n.sims = 1000, 
                stat = "mean", #"median", "mean"
                type = "linear.prediction", #"linear.prediction", "probability"
                include.resid.var = FALSE, 
                returnSims = FALSE, 
                seed = NULL,
                fix.intercept.variance = FALSE)
new.data.all <- cbind(new.data.all, prediction_int_bysex_rg)
```

```{r}
new.data.all$sex_rg <- ifelse(new.data.all$sex=="F" & new.data.all$ASD=="1", "Female ASD+", 
                          ifelse(new.data.all$sex=="M" & new.data.all$ASD=="1", "Male ASD+",
                                 ifelse(new.data.all$sex=="F" & new.data.all$ASD=="0", "Female ASD-",
                                        ifelse(new.data.all$sex=="M" & new.data.all$ASD=="0", "Male ASD-", NA))))
g_face_sex_rg <-  ggplot(data=new.data.all, 
                         aes(x = block.05/4, y = fit,
                             group=age, col=as.factor(age),
                             fill=as.factor(age))) +
  
  stat_summary(fun.y="mean", geom="point",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.face,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +
  stat_summary(fun.data="mean_se", geom="errorbar",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.face,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +

  
  stat_summary(aes(ymin=lwr, ymax=upr),
    fun.data = "mean_ci", geom="ribbon", alpha=0.2) +
  stat_summary(fun.y = "mean", geom="path") +
  labs(x="Time in Trial (s)", 
       y="Proportional Looking Time", 
       fill="Age (months)", 
       color="Age (months)",
       caption="AOI: FACE") +
  facet_wrap(~sex_rg) +
  geom_hline(yintercept = 0.2, linetype="dashed")
g_face_sex_rg
# ggsave(g_face_sex_rg, file="Plots/fit-pred-int-sex-rg.jpg", width = 9)
```

```{r}
g_face_2 <- ggarrange(g_face, g_face_sex_rg, nrow = 2, common.legend = TRUE)
ggsave(g_face_2, file="Plots/g_face_2.pdf", width = 9, height = 16)
```

```{r}
# summary(m_3_t_a_rg2_comp)
fe <- fixef(m_3_t_a_rg3_comp) %>% 
  as.data.frame() %>%
  tibble::rownames_to_column("term")
fe
```


```{r}
age <- c(5,10,14,24,36)
f <- fe[fe$term=="(Intercept)",2] + (fe[fe$term=="age",2]*age)     
fasd <- f + fe[fe$term=="ASD1",2] + (fe[fe$term=="age:ASD1",2]*age)
m <- f + fe[fe$term=="sexM",2] + (fe[fe$term=="age:sexM",2]*age) 
masd <- m + fe[fe$term=="sexM:ASD1",2] + (fe[fe$term=="age:sexM:ASD1",2]*age) 

f <- data.frame(sex="f", LH="LL", cbind(age), cbind(f))
fasd <- data.frame(sex="f", LH="EL",  cbind(age), cbind(fasd))
m <- data.frame(sex="m", LH="LL", cbind(age), cbind(m))
masd <- data.frame(sex="m", LH="EL",  cbind(age), cbind(masd))

colnames(f)[4] <- "I"
colnames(fasd)[4] <- "I"
colnames(m)[4] <- "I"
colnames(masd)[4] <- "I"

avg.h <- rbind(f, fasd, m, masd)
```

```{r}
fm_I_plot <- ggplot(data=avg.h, aes(x=as.factor(age), y=I, fill=LH)) + 
  geom_bar(stat="identity", position="dodge", color="black") + facet_wrap(~sex) +
  labs(x="Age (months)", y="Average Height of the Curve (Intercept)", fill="Likelihood Group") +
  scale_fill_manual(values=c("coral1", "cornsilk")) +
  geom_segment(aes(x="36", xend="36", y=0.4, yend=0.35), col="red", 
               arrow = arrow(length = unit(0.5, "cm")))
fm_I_plot
ggsave(fm_I_plot, file="Plots/fm_I_plot.jpg", width = 9)
```

# Compare to CAR

## Only age

```{r, include=FALSE}
# confidence intervals
set.seed(88)
ci <- confint(mc_3_t_a_rg2_comp, method="Wald")
ci <- data.frame(ci[-c(1:8),])
ci <- ci %>% tibble::rownames_to_column("term")
```
```{r, include=FALSE}
# estimates
est <- data.frame(summary(mc_3_t_a_rg2_comp)$coef)
est_car <- est %>% 
  add_rownames("term") %>%
  inner_join(ci, by="term") %>%
  rename("p.value"=Pr...t..,
         "st.error"=Std..Error,
         "CI_2.5"=X2.5..,
         "CI_97.5"=X97.5..) %>%
  mutate(Sign=ifelse(p.value<0.001, "**", 
                     ifelse(p.value<0.05, "*",
                            ifelse(p.value < 0.1, ".", "-"))),
         Estimate=100*Estimate,
         st.error=100*st.error,
         CI_2.5=100*CI_2.5,
         CI_97.5=100*CI_97.5) %>%
  mutate_each(funs(round(.,2)), -term, -Sign)
est_car
```

## With RG

```{r, include=FALSE}
# confidence intervals
set.seed(88)
ci <- confint(mc_3_t_a_rg2_comp, method="Wald")
ci <- data.frame(ci[-c(1:8),])
ci <- ci %>% tibble::rownames_to_column("term")
```
```{r, include=FALSE}
# estimates
est <- data.frame(summary(mc_3_t_a_rg2_comp)$coef)
est_car.2 <- est %>% 
  add_rownames("term") %>%
  inner_join(ci, by="term") %>%
  rename("p.value"=Pr...t..,
         "st.error"=Std..Error,
         "CI_2.5"=X2.5..,
         "CI_97.5"=X97.5..) %>%
  mutate(Sign=ifelse(p.value<0.001, "**", 
                     ifelse(p.value<0.05, "*",
                            ifelse(p.value < 0.1, ".", "-"))),
         Estimate=100*Estimate,
         st.error=100*st.error,
         CI_2.5=100*CI_2.5,
         CI_97.5=100*CI_97.5) %>%
  mutate_each(funs(round(.,2)), -term, -Sign)
est_car.2
```

# Prediction Intervals

## 1

```{r, include=FALSE}
new.data <- expand.grid(age=unique(data.aggr.0.5.rg.clean$age),
                        item=unique(data.aggr.0.5.rg.clean$item),
                        block.05=unique(data.aggr.0.5.rg.clean$block.05),
                        ASD=unique(data.aggr.0.5.rg.clean$ASD),
                        # ADHD=unique(data.aggr.0.5.rg.clean$ADHD),
                        id=1)
t <- poly((unique(new.data$block.05)), 3)
new.data[,paste("ot", 1:3, sep="")] <- t[new.data$block.05, 1:3]
# new.data$pred <- predict(mc_2_t_a_rg2_comp, new.data, allow.new.levels = TRUE)
# new.data <- arrange(new.data, age)
```

```{r}
library(merTools)
set.seed(88)
prediction_int_byage <- predictInterval(mc_3_t_a_rg2_comp, 
                newdata=new.data, 
                which = "full", #"full", "fixed", "random", "all"
                level = 0.95, n.sims = 1000, 
                stat = "mean", #"median", "mean"
                type = "linear.prediction", #"linear.prediction", "probability"
                include.resid.var = FALSE, 
                returnSims = FALSE, 
                seed = NULL,
                fix.intercept.variance = FALSE)
new.data <- cbind(new.data, prediction_int_byage)
```

```{r}

# new.data$ASD <- ifelse(new.data$ASD=="1", "High-Likelihood ASD", "Low-Likelihood ASD")
# new.data$ADHD <- ifelse(new.data$ADHD=="1", "High-Likelihood ADHD", "Low-Likelihood ADHD")
# data.aggr.0.5.rg.clean$ASD1 <- data.aggr.0.5.rg.clean$ASD
  
# data.aggr.0.5.rg.clean$ASD <- ifelse(data.aggr.0.5.rg.clean$ASD=="1", "High-Likelihood ASD", "Low-Likelihood ASD")
# data.aggr.0.5.rg.clean$ADHD <- ifelse(data.aggr.0.5.rg.clean$ADHD=="1", "High-Likelihood ADHD", "Low-Likelihood ADHD")

g_car <- new.data %>%
  # filter(t1_ageyrs==6) %>%
  ggplot(aes(x = block.05/4, y = fit, 
             group=age, col=as.factor(age),
             fill=as.factor(age))) +
  
  stat_summary(fun.y="mean", geom="point",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.car,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +
  stat_summary(fun.data="mean_se", geom="errorbar",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.car,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +

  
  stat_summary(aes(ymin=lwr, ymax=upr),
    fun.data = "mean_ci", geom="ribbon", alpha=0.2) +
  stat_summary(fun.y = "mean", geom="path") +
  
  labs(x="Time in Trial (s)", 
       y="Proportional Looking Time", 
       fill="Age (months)", 
       color="Age (months)",
       caption="AOI: CAR") +
  # facet_wrap(~ASD) +
  coord_cartesian(ylim = c(0, 0.45)) 
g_car
# ggsave(g, file="Plots/fit-pred-int-car.pdf", width = 9)
```

## 2

```{r, include=FALSE}
new.data <- expand.grid(age=unique(data.aggr.0.5.rg.clean$age),
                        item=unique(data.aggr.0.5.rg.clean$item),
                        block.05=unique(data.aggr.0.5.rg.clean$block.05),
                        ASD=unique(data.aggr.0.5.rg.clean$ASD),
                        # ADHD=unique(data.aggr.0.5.rg.clean$ADHD),
                        id=1)
t <- poly((unique(new.data$block.05)), 3)
new.data[,paste("ot", 1:3, sep="")] <- t[new.data$block.05, 1:3]
# new.data$pred <- predict(mc_2_t_a_rg2_comp, new.data, allow.new.levels = TRUE)
# new.data <- arrange(new.data, age)
```

```{r}
library(merTools)
set.seed(88)
prediction_int_byage <- predictInterval(mc_3_t_a_rg2_comp, 
                newdata=new.data, 
                which = "full", #"full", "fixed", "random", "all"
                level = 0.95, n.sims = 1000, 
                stat = "mean", #"median", "mean"
                type = "linear.prediction", #"linear.prediction", "probability"
                include.resid.var = FALSE, 
                returnSims = FALSE, 
                seed = NULL,
                fix.intercept.variance = FALSE)
new.data <- cbind(new.data, prediction_int_byage)
```

```{r}

new.data$ASD <- ifelse(new.data$ASD=="1", "High-Likelihood ASD", "Low-Likelihood ASD")
# new.data$ADHD <- ifelse(new.data$ADHD=="1", "High-Likelihood ADHD", "Low-Likelihood ADHD")
data.aggr.0.5.rg.clean$ASD1 <- data.aggr.0.5.rg.clean$ASD
  
data.aggr.0.5.rg.clean$ASD <- ifelse(data.aggr.0.5.rg.clean$ASD=="1", "High-Likelihood ASD", "Low-Likelihood ASD")
# data.aggr.0.5.rg.clean$ADHD <- ifelse(data.aggr.0.5.rg.clean$ADHD=="1", "High-Likelihood ADHD", "Low-Likelihood ADHD")

g_car_rg <- new.data %>%
  # filter(t1_ageyrs==6) %>%
  ggplot(aes(x = block.05/4, y = fit, 
             group=age, col=as.factor(age),
             fill=as.factor(age))) +
  
  stat_summary(fun.y="mean", geom="point",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.car,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +
  stat_summary(fun.data="mean_se", geom="errorbar",
               data=data.aggr.0.5.rg.clean,
               aes(y=m.plt.car,
                   x=block.05/4,
                   col=as.factor(age)),
               position=position_dodge(0.1)) +

  
  stat_summary(aes(ymin=lwr, ymax=upr),
    fun.data = "mean_ci", geom="ribbon", alpha=0.2) +
  stat_summary(fun.y = "mean", geom="path") +
  
  labs(x="Time in Trial (s)", 
       y="Proportional Looking Time", 
       fill="Age (months)", 
       color="Age (months)",
       caption="AOI: CAR") +
  facet_wrap(~ASD) +
  coord_cartesian(ylim = c(0, 0.45)) 
g_car_rg
# ggsave(g, file="Plots/fit-pred-int-car.pdf", width = 9)
```

```{r}
save(est_face, g_face, 
     est_face_sex, g_face_sex, 
     est_face_sex_rg, new.data.all, g_face_sex_rg,
     fm_I_plot,
     est_car, g_car, g_car_rg,
     file = "SavedWS/tb_plots.RData")
```


